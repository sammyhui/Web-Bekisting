<?php
// Koneksi ke Database
$host = "localhost";
$user = "root";
$pass = "";
$db   = "bekisting";

$conn = mysqli_connect($host, $user, $pass, $db);

if (!$conn) {
    die("Koneksi gagal: " . mysqli_connect_error());
}

// Ambil data dari form contact.php
// Menggunakan mysqli_real_escape_string untuk mencegah SQL Injection (Penting untuk tugas kuliah!)
$nama   = mysqli_real_escape_string($conn, $_POST['name']);
$email  = mysqli_real_escape_string($conn, $_POST['email']);
$subjek = mysqli_real_escape_string($conn, $_POST['subject']);
$pesan  = mysqli_real_escape_string($conn, $_POST['message']);

if (isset($nama) && isset($email)) {
    
    // 1. Simpan ke Database
    $query = "INSERT INTO pesan (nama, email, subjek, pesan) VALUES ('$nama', '$email', '$subjek', '$pesan')";
    
    if (mysqli_query($conn, $query)) {
        
        /* 2. Opsi Kirim ke Email (Hanya jalan kalau di hosting/server beneran)
           $to = "admin@mitrabekisting.com";
           $body = "Pesan Baru dari: $nama \n Email: $email \n Isi: $pesan";
           mail($to, $subjek, $body);
        */

        // Notifikasi Berhasil & Kembali ke halaman kontak
        echo "<script>
                alert('Pesan berhasil terkirim! Tim kami akan segera menghubungi Anda.');
                window.location.href='contact.php';
              </script>";
    } else {
        echo "Error: " . $query . "<br>" . mysqli_error($conn);
    }
}

mysqli_close($conn);
?>